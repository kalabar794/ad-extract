<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Investigation Dashboard - Epstein Archive</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            min-height: 100vh;
            padding: 30px;
            color: #e0e0e0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 30px 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        h1 {
            color: #fff;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #e74c3c;
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        header p {
            color: #a0a0a0;
        }

        .warning {
            background: rgba(255, 152, 0, 0.15);
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #ffa726;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(231, 76, 60, 0.2);
            border-color: rgba(231, 76, 60, 0.3);
        }

        .card h2 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
        }

        .card p {
            color: #a0a0a0;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(231, 76, 60, 0.4);
        }

        button:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #a0a0a0;
            font-weight: bold;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #e74c3c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .results h3 {
            color: #fff;
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .results pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 18px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 500px;
            overflow-y: auto;
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .crime-list {
            background: rgba(211, 47, 47, 0.15);
            border-left: 4px solid #d32f2f;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            color: #e0e0e0;
        }

        .crime-list li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .suspect-card {
            background: rgba(255, 111, 0, 0.15);
            border-left: 4px solid #ff6f00;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            color: #e0e0e0;
        }

        .suspect-card strong {
            color: #ff6f00;
            font-size: 1.1em;
        }

        .lead-item {
            background: rgba(25, 118, 210, 0.15);
            border-left: 4px solid #1976d2;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            color: #e0e0e0;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus, input[type="number"]:focus {
            border-color: #e74c3c;
            background: rgba(255, 255, 255, 0.08);
            outline: none;
        }

        .back-link {
            display: inline-block;
            color: #2196f3;
            text-decoration: none;
            font-weight: 600;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            color: #42a5f5;
        }

        .severity-high {
            background: #ffcdd2;
            color: #b71c1c;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }

        .severity-medium {
            background: #fff9c4;
            color: #f57f17;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }

        .api-key-setup {
            background: rgba(76, 175, 80, 0.15);
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            color: #e0e0e0;
        }

        .api-key-setup h3 {
            color: #66bb6a;
            margin-bottom: 15px;
        }

        .api-key-setup p {
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .api-key-setup a {
            color: #2196f3;
        }

        .api-key-setup code {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 6px;
            font-family: monospace;
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Back to Main Dashboard</a>

        <header>
            <h1>üîç AI-Powered Investigation Dashboard</h1>
            <p class="subtitle">Using Artificial Intelligence to Uncover Crimes and Bring Justice to Victims</p>
            <div class="warning">
                <strong>‚ö†Ô∏è IMPORTANT:</strong> This tool uses Claude AI to analyze documents for evidence of crimes,
                identify perpetrators, build relationship networks, and generate investigative leads.
                Focus is on EVIDENCE and JUSTICE for victims, not gossip or speculation.
            </div>
        </header>

        <div class="api-key-setup">
            <h3>üîë Quick Setup - You Have Claude Pro!</h3>
            <p><strong>Step 1:</strong> Go to <a href="https://console.anthropic.com/settings/keys" target="_blank">https://console.anthropic.com/settings/keys</a></p>
            <p><strong>Step 2:</strong> Click "Create Key" to generate an API key</p>
            <p><strong>Step 3:</strong> Copy the key and run in terminal:</p>
            <code>export ANTHROPIC_API_KEY='your-key-here'</code>
            <p><strong>Step 4:</strong> Restart Flask app</p>
            <p style="margin-top: 10px;"><em>Note: API usage is separate from Claude Pro. You get $5 free credit (~10-15 full reports). After that it's ~$0.30-0.60 per full report.</em></p>
        </div>

        <div class="main-grid">
            <!-- Generate Investigation Report -->
            <div class="card">
                <h2>üìä Generate Full Investigation Report</h2>
                <p>AI analyzes all documents to produce a comprehensive report identifying:
                    crimes, suspects, victims, evidence, criminal networks, and investigative leads.</p>
                <button id="btn-report" onclick="generateReport()">Generate Investigation Report</button>
                <div id="loading-report" class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing documents... This may take 30-60 seconds...</p>
                </div>
            </div>

            <!-- Analyze Document -->
            <div class="card">
                <h2>üìÑ Analyze Specific Document</h2>
                <p>Deep AI analysis of a single document to identify crimes, victims, perpetrators, and evidence.</p>
                <input type="number" id="doc-id" placeholder="Enter Document ID" min="1">
                <button id="btn-analyze" onclick="analyzeDocument()">Analyze Document</button>
                <div id="loading-analyze" class="loading">
                    <div class="spinner"></div>
                    <p>Analyzing document for criminal activity...</p>
                </div>
            </div>

            <!-- Relationship Network -->
            <div class="card">
                <h2>üï∏Ô∏è Relationship Network Analysis</h2>
                <p>AI-powered analysis of relationships between entities to identify criminal networks,
                    facilitators, and suspicious connections.</p>
                <input type="text" id="entity-name" placeholder="Entity name (optional - leave blank for all)">
                <button id="btn-network" onclick="analyzeNetwork()">Analyze Relationships</button>
                <div id="loading-network" class="loading">
                    <div class="spinner"></div>
                    <p>Building relationship network...</p>
                </div>
            </div>

            <!-- Suspicious Patterns -->
            <div class="card">
                <h2>üö® Find Suspicious Patterns</h2>
                <p>Automatically identifies documents with suspicious keywords and patterns that indicate
                    criminal activity, cover-ups, or evidence requiring investigation.</p>
                <button id="btn-patterns" onclick="findPatterns()">Scan for Suspicious Patterns</button>
                <div id="loading-patterns" class="loading">
                    <div class="spinner"></div>
                    <p>Scanning documents for suspicious patterns...</p>
                </div>
            </div>
        </div>

        <!-- Results Display -->
        <div id="results" class="results"></div>
    </div>

    <script>
        function showLoading(id) {
            document.getElementById(`loading-${id}`).classList.add('active');
            document.getElementById(`btn-${id}`).disabled = true;
        }

        function hideLoading(id) {
            document.getElementById(`loading-${id}`).classList.remove('active');
            document.getElementById(`btn-${id}`).disabled = false;
        }

        function showResults(html) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = html;
            resultsDiv.classList.add('active');
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        async function generateReport() {
            showLoading('report');

            try {
                const response = await fetch('/api/ai/investigation-report');
                const data = await response.json();

                if (data.error) {
                    showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${data.error}</p>${getApiKeyHelp()}`);
                    hideLoading('report');
                    return;
                }

                let html = '<h2 style="color: #1e3c72;">üîç AI Investigation Report</h2>';

                if (data.executive_summary) {
                    html += `<h3>Executive Summary</h3><div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 10px 0;">${data.executive_summary}</div>`;
                }

                if (data.documented_crimes && data.documented_crimes.length > 0) {
                    html += '<h3>‚ö†Ô∏è Documented Crimes</h3><ul class="crime-list">';
                    data.documented_crimes.forEach(crime => {
                        html += `<li>${crime}</li>`;
                    });
                    html += '</ul>';
                }

                if (data.key_suspects && data.key_suspects.length > 0) {
                    html += '<h3>üë§ Key Suspects</h3>';
                    data.key_suspects.forEach(suspect => {
                        html += `<div class="suspect-card">
                            <strong>${suspect.name || 'Unknown'}</strong><br>
                            <strong>Role:</strong> ${suspect.role || 'N/A'}<br>
                            <strong>Evidence:</strong> ${suspect.evidence || 'N/A'}
                        </div>`;
                    });
                }

                if (data.investigative_leads && data.investigative_leads.length > 0) {
                    html += '<h3>üîé Investigative Leads</h3>';
                    data.investigative_leads.forEach(lead => {
                        html += `<div class="lead-item">${lead}</div>`;
                    });
                }

                if (data.recommended_actions && data.recommended_actions.length > 0) {
                    html += '<h3>üìã Recommended Actions</h3><ul>';
                    data.recommended_actions.forEach(action => {
                        html += `<li>${action}</li>`;
                    });
                    html += '</ul>';
                }

                if (data.justice_for_victims) {
                    html += `<h3 style="color: #d32f2f;">‚öñÔ∏è Justice for Victims</h3><div style="background: #ffebee; padding: 15px; border-radius: 8px; margin: 10px 0;">${data.justice_for_victims}</div>`;
                }

                html += '<h3>Full Report (JSON)</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';

                showResults(html);
            } catch (error) {
                showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${error.message}</p>`);
            }

            hideLoading('report');
        }

        async function analyzeDocument() {
            const docId = document.getElementById('doc-id').value;

            if (!docId) {
                alert('Please enter a document ID');
                return;
            }

            showLoading('analyze');

            try {
                const response = await fetch(`/api/ai/analyze-document/${docId}`, { method: 'POST' });
                const data = await response.json();

                if (data.error) {
                    showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${data.error}</p>${getApiKeyHelp()}`);
                    hideLoading('analyze');
                    return;
                }

                let html = `<h2 style="color: #1e3c72;">üìÑ Document Analysis: ${data.document || `Document ${docId}`}</h2>`;

                if (data.severity) {
                    html += `<span class="severity-${data.severity}">Severity: ${data.severity.toUpperCase()}</span>`;
                }

                if (data.executive_summary) {
                    html += `<h3>Summary</h3><p style="background: #f5f5f5; padding: 15px; border-radius: 8px;">${data.executive_summary}</p>`;
                }

                if (data.criminal_activity_found && data.criminal_activity_found.length > 0) {
                    html += '<h3>‚ö†Ô∏è Criminal Activity Found</h3><ul class="crime-list">';
                    data.criminal_activity_found.forEach(crime => {
                        html += `<li>${crime}</li>`;
                    });
                    html += '</ul>';
                }

                if (data.key_evidence && data.key_evidence.length > 0) {
                    html += '<h3>üìã Key Evidence</h3><ul>';
                    data.key_evidence.forEach(evidence => {
                        html += `<li>${evidence}</li>`;
                    });
                    html += '</ul>';
                }

                if (data.investigative_leads && data.investigative_leads.length > 0) {
                    html += '<h3>üîé Investigative Leads</h3>';
                    data.investigative_leads.forEach(lead => {
                        html += `<div class="lead-item">${lead}</div>`;
                    });
                }

                html += '<h3>Full Analysis (JSON)</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';

                showResults(html);
            } catch (error) {
                showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${error.message}</p>`);
            }

            hideLoading('analyze');
        }

        async function analyzeNetwork() {
            const entityName = document.getElementById('entity-name').value;

            showLoading('network');

            try {
                let url = '/api/ai/relationship-network?min=5';
                if (entityName) {
                    url += `&entity=${encodeURIComponent(entityName)}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${data.error}</p>${getApiKeyHelp()}`);
                    hideLoading('network');
                    return;
                }

                let html = '<h2 style="color: #1e3c72;">üï∏Ô∏è Relationship Network Analysis</h2>';

                if (data.executive_summary) {
                    html += `<h3>Summary</h3><p style="background: #f5f5f5; padding: 15px; border-radius: 8px;">${data.executive_summary}</p>`;
                }

                if (data.key_players && data.key_players.length > 0) {
                    html += '<h3>üë• Key Players in Criminal Network</h3><ul class="crime-list">';
                    data.key_players.forEach(player => {
                        html += `<li>${player}</li>`;
                    });
                    html += '</ul>';
                }

                if (data.suspicious_connections && data.suspicious_connections.length > 0) {
                    html += '<h3>üö® Suspicious Connections</h3><ul>';
                    data.suspicious_connections.forEach(conn => {
                        html += `<li>${conn}</li>`;
                    });
                    html += '</ul>';
                }

                if (data.relationships && data.relationships.length > 0) {
                    html += `<h3>üìä Top Relationships (${data.relationships.length} total)</h3>`;
                    html += '<pre>' + JSON.stringify(data.relationships.slice(0, 20), null, 2) + '</pre>';
                }

                html += '<h3>Full Analysis (JSON)</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';

                showResults(html);
            } catch (error) {
                showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${error.message}</p>`);
            }

            hideLoading('network');
        }

        async function findPatterns() {
            showLoading('patterns');

            try {
                const response = await fetch('/api/ai/suspicious-patterns');
                const data = await response.json();

                if (data.error) {
                    showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${data.error}</p>`);
                    hideLoading('patterns');
                    return;
                }

                let html = '<h2 style="color: #1e3c72;">üö® Suspicious Patterns Found</h2>';

                html += `<p><strong>Total suspicious documents:</strong> ${data.total_suspicious || 0}</p>`;

                if (data.documents && data.documents.length > 0) {
                    html += '<h3>Documents Requiring Investigation</h3>';
                    data.documents.forEach((doc, i) => {
                        if (i < 20) {  // Show first 20
                            html += `<div class="suspect-card">
                                <strong>Document ID ${doc.doc_id}:</strong> ${doc.filename}<br>
                                <strong>Suspicious Keywords:</strong> ${doc.keywords.join(', ')}<br>
                                <strong>Excerpt:</strong> ${doc.excerpt.substring(0, 300)}...
                            </div>`;
                        }
                    });
                }

                showResults(html);
            } catch (error) {
                showResults(`<h3 style="color: #d32f2f;">Error</h3><p>${error.message}</p>`);
            }

            hideLoading('patterns');
        }

        function getApiKeyHelp() {
            return `<div class="api-key-setup" style="margin-top: 20px;">
                <h3>‚ö†Ô∏è API Key Not Set</h3>
                <p>See setup instructions at the top of this page.</p>
            </div>`;
        }
    </script>
</body>
</html>
